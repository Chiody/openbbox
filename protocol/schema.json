{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "OpenBBox PulseNode Schema v1.0",
  "description": "Standard data protocol for AI development evolution tracking. All adapters must normalize their output to this format.",
  "type": "object",
  "required": ["event_id", "timestamp", "source", "intent"],
  "properties": {
    "event_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for this pulse event"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of when the interaction occurred"
    },
    "project": {
      "type": "object",
      "properties": {
        "id": { "type": "string", "description": "Unique project hash or path-based ID" },
        "name": { "type": "string", "description": "Human-readable project name" },
        "path": { "type": "string", "description": "Absolute filesystem path to the project" }
      }
    },
    "source": {
      "type": "object",
      "required": ["ide"],
      "properties": {
        "ide": {
          "type": "string",
          "enum": ["Cursor", "Trae", "ClaudeCode", "VSCode", "Windsurf", "Codex", "Cline", "Aider", "Unknown"],
          "description": "The AI IDE or tool that generated this interaction"
        },
        "model_name": { "type": "string", "description": "AI model used (e.g., claude-3.5-sonnet, gpt-4o)" },
        "session_id": { "type": "string", "description": "Conversation session identifier" }
      }
    },
    "intent": {
      "type": "object",
      "required": ["raw_prompt"],
      "properties": {
        "raw_prompt": { "type": "string", "description": "The user's original instruction text" },
        "clean_title": { "type": "string", "description": "Auto-generated short title for display" },
        "context_files": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Files referenced or active when the prompt was sent"
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Auto-classified intent tags: Architecture, Feature, BugFix, Refactor, etc."
        }
      }
    },
    "execution": {
      "type": "object",
      "properties": {
        "ai_response": { "type": "string", "description": "The AI's full response text" },
        "reasoning": { "type": "string", "description": "AI's chain-of-thought or reasoning summary" },
        "thinking_blocks": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Extended thinking blocks from the AI"
        },
        "diffs": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "file_path": { "type": "string" },
              "hunk": { "type": "string", "description": "Unified diff hunk content" },
              "change_type": {
                "type": "string",
                "enum": ["added", "modified", "deleted", "renamed"]
              }
            }
          },
          "description": "Code changes associated with this interaction"
        },
        "affected_files": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of all files modified by this interaction"
        },
        "commits": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "hash": { "type": "string" },
              "message": { "type": "string" },
              "timestamp": { "type": "string", "format": "date-time" }
            }
          },
          "description": "Git commits associated with this interaction"
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["pending", "completed", "failed"],
          "default": "completed"
        },
        "token_usage": {
          "type": "object",
          "properties": {
            "input": { "type": "integer" },
            "output": { "type": "integer" }
          }
        },
        "match_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Confidence score of the prompt-to-diff alignment"
        },
        "is_manual_marked": {
          "type": "boolean",
          "default": false,
          "description": "Whether a human manually confirmed this linkage"
        }
      }
    }
  }
}
